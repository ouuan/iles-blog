---
title: CNATDA ç¬¬äºŒç« å­¦ä¹ ç¬”è®°
date: 2023-06-12T20:42:32+08:00
image: cnatda-2.png
tags:
-   cnatda
-   å­¦ä¹ ç¬”è®°
---

ã€ŠComputer Networking: A Top-Down Approach (8th Edition)ã€‹ç¬¬äºŒç«  â€œApplication Layerâ€ çš„å­¦ä¹ ç¬”è®°ã€‚

<Excerpt />

## Principles of Network Applications

application architecture ä¸»è¦åˆ†ä¸º client-server å’Œ P2P ä¸¤ç§ã€‚

*process* å³åœ¨æŸä¸ª end system ä¸Šè¿è¡Œçš„ç¨‹åºï¼ˆè¿›ç¨‹ï¼‰ï¼Œä¸åŒ end system ä¸Šçš„ process åœ¨ç½‘ç»œä¸Šäº’ç›¸å‘é€ message ä»¥è¿›è¡Œé€šä¿¡ï¼ˆæ³¨ï¼šmessage å³ application-layer packetï¼‰ã€‚

åœ¨ä¸€æ¬¡é€šä¿¡ä¸­ï¼Œå‘èµ·é€šä¿¡çš„ä¸€æ–¹è¢«ç§°ä½œ *client*ï¼Œç­‰å¾…æ¥æ”¶æ¶ˆæ¯çš„ä¸€æ–¹è¢«ç§°ä½œ *server*ã€‚ï¼ˆæ³¨ï¼šåœ¨ P2P ä¸­ï¼Œclient å’Œ server çš„èº«ä»½ä¸æ˜¯å›ºå®šçš„ã€‚ï¼‰

process å’Œç½‘ç»œï¼Œæˆ–è€…è¯´å’Œ transport layer ä¹‹é—´ä»¥ *socket* ä½œä¸º APIã€‚

host ç”± IP åœ°å€è¯†åˆ«ï¼Œè€Œ process ç”± IP åœ°å€ + ç«¯å£è¯†åˆ«ã€‚

ä¸€ä¸ª application å¯ä»¥é€‰æ‹© TCP æˆ–è€… UDP æ¥æä¾› transport serviceã€‚TCP æä¾› connection-oriented serviceï¼ˆéœ€è¦é€šè¿‡ handshaking å»ºç«‹ TCP connectionï¼‰å’Œ reliable data transfer serviceï¼ˆä¿è¯æ¥æ”¶åˆ° & ä¿åºï¼‰ï¼Œä»¥åŠ congestion controlã€‚UDP åˆ™è¿™äº›éƒ½ä¸æä¾›ã€‚ä¸€èˆ¬ä¼šæ ¹æ®æ˜¯å¦ loss-tolerantï¼ˆæ˜¯å¦å…è®¸ä¸¢å¤±éƒ¨åˆ†æ•°æ®ï¼‰ä»¥åŠå¯¹å»¶æ—¶çš„æ•æ„Ÿåº¦æ¥è¿›è¡Œé€‰æ‹©ã€‚

TLS (Transport Layer Security) å¯ä»¥åœ¨ TCP çš„åŸºç¡€ä¸Šæä¾› encryptionã€data integrityã€end-point authenticationã€‚å®ƒè‡ªèº«ä½äº application layerï¼ˆæˆ–è€…å¯ä»¥è¯´æ˜¯ application ä¸ transport layer ä¹‹é—´ ğŸ¤”ï¼‰ï¼Œä¸ä¸ TCPã€UDP å¹¶åˆ—ã€‚

application-layer protocol å†³å®šäº† message çš„ç»“æ„ä»¥åŠç›¸åº”çš„è¡Œä¸ºã€‚å¸¸è§çš„ application-layer protocol åŒ…æ‹¬ HTTPã€SMTPã€Telnetã€FTPã€SIPã€RTPã€DASH ç­‰ã€‚æœ‰çš„ application ä¼šä½¿ç”¨ä¸“æœ‰è€Œé public domain çš„ application-layer protocolã€‚

## The Web and HTTP

HTTP (HyperText Transfer Protocol) æ˜¯ Web çš„ application-layer protocolï¼Œå®šä¹‰äº† client (browser) å¦‚ä½•å‘ server è¯·æ±‚æ–‡ä»¶ï¼ˆweb pageï¼‰ã€server å¦‚ä½•å°†æ–‡ä»¶ä¼ è¾“ç»™ clientã€‚

HTTP çš„é»˜è®¤ç«¯å£æ˜¯ 80ã€‚

HTTP ä¸å­˜å‚¨ client çš„ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ª *stateless protocol*ã€‚

HTTPï¼ˆ1.0ã€1.1ã€2ï¼‰åŸºäº TCPï¼Œæœ‰ persistent connection å’Œ non-persistent connection ä¸¤ç§å·¥ä½œæ–¹å¼ï¼š

-   non-persistent connectionï¼šæ¯æ¬¡ request-response éƒ½ä¼šå»ºç«‹ä¸€ä¸ªæ–°çš„ TCP connectionï¼Œæ”¶åˆ° response åç«‹åˆ»å…³é—­ TCP connectionã€‚
-   persistent connectionï¼šåŒä¸€å¯¹ client-server çš„å¤šæ¬¡ request-responseï¼ˆä¾‹å¦‚ä¸€ä¸ªé¡µé¢å¼•ç”¨çš„å¤šä¸ªèµ„æºï¼‰å¯ä»¥å…±ç”¨åŒä¸€ä¸ª TCP connectionï¼ˆåœ¨é—²ç½®ä¸€æ®µæ—¶é—´åè‡ªåŠ¨å…³é—­ï¼‰ï¼Œå¹¶ä¸”æ— éœ€ç­‰å¾… response å°±å¯ä»¥è¿ç»­å‘é€å¤šä¸ª requestï¼ˆè¢«ç§°ä½œ *pipelining*ï¼‰ï¼Œä»è€Œçœä¸‹æ¯æ¬¡å»ºç«‹ TCP connection è€—è´¹çš„ RTT (round-trip time)ã€‚

HTTP message æ˜¯çº¯æ–‡æœ¬ï¼Œæ ¼å¼å¦‚ä¸‹ã€‚

HTTP request:[^fig2.8]

[^fig2.8]: p103, Figure 2.8: General format of an HTTP request message

![General format of an HTTP request message](cnatda-fig-2.8.png)

```http
GET /wireshark-labs/INTRO-wireshark-file1.html HTTP/1.1
Host: gaia.cs.umass.edu
User-Agent: curl/8.1.2
Accept: */*
```

HTTP response:[^fig2.9]

[^fig2.9]: p104, Figure 2.9: General format of an HTTP response message

![General format of an HTTP response message](cnatda-fig-2.9.png)

```http
HTTP/1.1 200 OK
Date: Tue, 13 Jun 2023 11:14:57 GMT
Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips PHP/7.4.33 mod_perl/2.0.11 Perl/v5.16.3
Last-Modified: Tue, 13 Jun 2023 05:59:01 GMT
ETag: "51-5fdfc882a3e6f"
Accept-Ranges: bytes
Content-Length: 81
Content-Type: text/html; charset=UTF-8

<html>
Congratulations!  You've downloaded the first Wireshark lab file!
</html>
```

server å¯ä»¥é€šè¿‡ Cookie è¯†åˆ«ç”¨æˆ·ï¼Œcookie é€šè¿‡ response ä¸­çš„ `Set-Cookie` header è®¾ç½®ï¼Œåœ¨ä¹‹åçš„æ¯æ¬¡ request ä¸­é€šè¿‡ `Cookie` header å‘ç»™ serverã€‚

æœºæ„å¯ä»¥è®¾ç½® Web cacheï¼Œä½¿ç”¨æˆ·å…ˆå‘ Web cache å‘é€è¯·æ±‚ï¼Œè‹¥ cache hit åˆ™ç›´æ¥ç”± Web cache å‘ç»™ç”¨æˆ·ï¼Œè‹¥ cache miss åˆ™ Web cache å‘ origin server å‘é€è¯·æ±‚å†è¿”å›ç»™ç”¨æˆ·ã€‚Web cache å¯ä»¥å‡å°å»¶è¿Ÿï¼Œé™ä½å¸¦å®½å‹åŠ›ã€‚ï¼ˆä¸ä¹‹ç±»ä¼¼çš„ CDN åˆ™åœ¨[åæ–‡](#content-distribution-networks)æœ‰è¯¦ç»†è®²è§£ã€‚ï¼‰

å¯ä»¥é€šè¿‡ `If-Modified-Since` header è¿›è¡Œ *conditional GET*ï¼Œè‹¥æ²¡æœ‰ä¿®æ”¹åˆ™ä¼šè¿”å› body ä¸ºç©ºçš„ 304 Not Modifiedã€‚

HTTP/2 æä¾›äº† request and response multiplexingã€prioritizationã€server push æ¥ä¼˜åŒ–æ€§èƒ½ï¼š

-   multiplexingï¼špersistent connection å‡å°‘äº†å»ºç«‹ TCP connection å¸¦æ¥çš„ RTTï¼Œä½†åˆå¼•å…¥äº† Head of Line (HOL) blockingï¼Œå³å…±ç”¨ä¸€ä¸ª TCP connection æ—¶è¾ƒå°çš„èµ„æºéœ€è¦ç­‰å¾…è¾ƒå¤§çš„èµ„æºåŠ è½½å®Œæ¯•ï¼Œæ‰€ä»¥åœ¨ HTTP/1.1 ä¸­æµè§ˆå™¨ç»å¸¸è¿˜æ˜¯ä¼šå»ºç«‹å¤šä¸ª TCP è¿æ¥ï¼Œé™¤äº†è§£å†³ HOL blockingï¼Œä¹Ÿå¯ä»¥åœ¨ TCP çš„ congestion control ä¸­å–å¾—æ›´å¤šå¸¦å®½ã€‚HTTP/2 åˆ™å°†æ¯ä¸ª message åˆ’åˆ†æˆäº†å¤šä¸ªå°çš„ frameï¼Œå¹¶äº¤æ›¿å‘é€ä¸åŒ message çš„ frameï¼ˆframe interleavingï¼‰ï¼Œä»è€Œå°çš„èµ„æºæ— éœ€ç­‰å¾…å¤§çš„èµ„æºå‘é€å®Œæ¯•ã€‚
-   prioritizationï¼šåŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚æ—¶ï¼Œå¯ä»¥ä¸ºæ¯ä¸ª response è®¾ç½®ä¼˜å…ˆçº§ï¼Œè®© server ä¼˜å…ˆå‘é€é«˜ä¼˜å…ˆçº§çš„ responseã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è®¾ç½® response ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚
-   server pushï¼šä¸€ä¸ª request å¯ä»¥æœ‰å¤šä¸ª responseï¼Œå³é™¤äº†å¯¹åº”äº request çš„ responseï¼Œserver è¿˜å¯ä»¥é¢å¤– *push*ï¼Œä¾‹å¦‚åœ¨è¿”å›ä¸€ä¸ª HTML é¡µé¢æ—¶å¯ä»¥ push è¿™ä¸ªé¡µé¢å¼•ç”¨çš„å…¶ä»–èµ„æºã€‚

HTTP/3 ä½¿ç”¨åŸºäº UDP çš„ QUIC ä»£æ›¿äº† TCPã€‚

## Electronic Mail in the Internet

e-mail ç³»ç»Ÿæœ‰ä¸‰ä¸ªä¸»è¦ç»„ä»¶ï¼šuser agentã€mail server å’Œ SMTP (Simple Mail Transfer Protocol)ã€‚

å‘é€é‚®ä»¶æ—¶ï¼ŒAlice å†™å®Œé‚®ä»¶åç”±å¥¹çš„ user agent å‘é€åˆ°å¥¹çš„ mail serverï¼Œå¥¹çš„ mail server å†å‘åˆ° Bob çš„ mail server ä¸­å±äº Bob çš„ mailboxï¼Œä¹‹å Bob å†é€šè¿‡ä»–çš„ user agent ä»ä»–çš„ mail server è·å–ä»–çš„ mailbox ä¸­çš„é‚®ä»¶å¹¶é˜…è¯»ã€‚

å‘é€æ–¹çš„ mail server ä¼šç»´æŠ¤ä¸€ä¸ªå¾…å‘é€é‚®ä»¶åˆ—è¡¨ï¼Œå¦‚æœæ¥æ”¶æ–¹çš„ mail server åœ¨å½“æ—¶ä¸å¯ç”¨ï¼Œåˆ™ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´åå†æ¬¡å°è¯•ï¼Œå¤šæ¬¡å¤±è´¥åˆ™ä¼šé€€å›ã€‚

mail server ä½¿ç”¨ SMTP å‘å…¶ä»– mail server å‘é€é‚®ä»¶ï¼Œå‘é€æ–¹ä½œä¸º SMTP clientï¼Œæ¥æ”¶æ–¹ä½œä¸º SMTP serverã€‚

SMTP çš„é»˜è®¤ç«¯å£æ˜¯ 25ã€‚

SMTP æ˜¯ä¸€ä¸ªæ¯” HTTP è¿˜å¤è€çš„åè®®ï¼Œå¸¦æ¥çš„åæœä¹‹ä¸€æ˜¯å®ƒæ•´ä¸ª message éƒ½åªèƒ½åŒ…å« ASCIIã€‚

ä¸€æ¬¡ SMTP é€šä¿¡å¦‚ä¸‹æ‰€ç¤ºï¼š[^smtp-example]

[^smtp-example]: [SMTP transport example - Simple Mail Transfer Protocol - Wikipedia](https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol#SMTP_transport_example)

```plain
S: 220 smtp.example.com ESMTP Postfix
C: HELO relay.example.org
S: 250 Hello relay.example.org, I am glad to meet you
C: MAIL FROM:<bob@example.org>
S: 250 Ok
C: RCPT TO:<alice@example.com>
S: 250 Ok
C: RCPT TO:<theboss@example.com>
S: 250 Ok
C: DATA
S: 354 End data with <CR><LF>.<CR><LF>
C: From: "Bob Example" <bob@example.org>
C: To: "Alice Example" <alice@example.com>
C: Cc: theboss@example.com
C: Date: Tue, 15 Jan 2008 16:02:43 -0500
C: Subject: Test message
C:
C: Hello Alice.
C: This is a test message with 5 header fields and 4 lines in the message body.
C: Your friend,
C: Bob
C: .
S: 250 Ok: queued as 12345
C: QUIT
S: 221 Bye
```

å…¶ä¸­ `HELO`ã€`MAIL FROM`ã€`RCPT TO`ã€`DATA`ã€`QUIT` ç­‰æ˜¯ *command*ï¼Œç”¨æ¥è¿›è¡Œ handshake ç­‰æ“ä½œã€‚å¦‚æœè¦å‘åŒä¸€ä¸ª mail server è¿ç»­å‘é€å¤šå°é‚®ä»¶ï¼Œå¯ä»¥åª `HELO`ã€`QUIT` ä¸€æ¬¡ï¼ˆä½†è¦ `MAIL FROM`ã€`RCPT TO` å¤šæ¬¡ï¼‰ä»è€Œå…±ç”¨ä¸€ä¸ª TCP è¿æ¥ã€‚`DATA` åæ˜¯é‚®ä»¶çš„å†…å®¹ï¼Œè¿™ä¸€å†…å®¹çš„å¼€å¤´æ˜¯é‚®ä»¶çš„ headerï¼Œç»“å°¾æ˜¯ä»…åŒ…å« `.` çš„ä¸€è¡Œã€‚

email æ˜¯ user agent â†’ mail server â†’ mail server â†’ user agent è€Œé user agent â†’ user agentï¼Œä¸€å¤§åŸå› æ˜¯å¦‚æœ user agent ç»å¸¸ä¸åœ¨çº¿åˆ™ç›´æ¥å‘å¾ˆå¯èƒ½æ”¶ä¸åˆ°é‚®ä»¶ï¼Œéœ€è¦ç”¨ mail server æ¥æé«˜åœ¨çº¿ç‡ä»¥åŠæä¾›å¯¹æ–¹ä¸åœ¨çº¿æ—¶é‡è¯•çš„æœºåˆ¶ã€‚

ä» user agent å‘åˆ° mail server æ—¶å¯ä»¥ä½¿ç”¨ SMTP æˆ– HTTPï¼Œä» mail server æ‹‰å–åˆ° user agent æ—¶å¯ä»¥ä½¿ç”¨ HTTP æˆ– IMAP (Internet Mail Access Protocol)ï¼ˆä¸èƒ½ç”¨ SMTPï¼Œå› ä¸º SMTP æ˜¯ push protocolï¼Œä¸èƒ½ç”¨æ¥ pullï¼‰ã€‚

## DNSâ€”The Internetâ€™s Directory Service

### Services Provided by DNS

host ç”± hostname æˆ– IP åœ°å€è¯†åˆ«ï¼Œhostname å¯¹äººç±»æ›´å‹å¥½ï¼Œè€Œ IP åœ°å€å¯¹è·¯ç”±å™¨æ›´å‹å¥½ã€‚

å°† hostname ç¿»è¯‘ä¸º IP åœ°å€æ˜¯ DNS çš„ä¸»è¦ä»»åŠ¡ã€‚DNS æ˜¯ç”±å¤šä¸ªå±‚çº§çš„ DNS server å…±åŒæ„æˆçš„ distributed databaseï¼Œä¹Ÿæ˜¯ä½¿å¾— application èƒ½å¤ŸæŸ¥è¯¢è¿™ä¸ª distributed database çš„ application-layer protocolã€‚

DNS è¢«å¾ˆå¤šå…¶ä»– application-layer protocol æ‰€ä½¿ç”¨ï¼Œä¾‹å¦‚åœ¨ HTTP/SMTP ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ hostname æ¥è®¿é—®ç½‘ç«™ / mail serverï¼Œè¿™æ—¶å°±ä¼šè°ƒç”¨ DNSã€‚

DNS åœ¨æä¾› hostname åˆ° IP åœ°å€çš„ç¿»è¯‘çš„åŒæ—¶ï¼Œè¿˜æä¾›äº†ä¸‹åˆ—åŠŸèƒ½ï¼š

-   host aliasing: å¯ä»¥è®©ä¸€ä¸ª host åœ¨æœ‰ canonical hostname çš„åŒæ—¶è¿˜æœ‰å…¶ä»– aliasã€‚
-   mail server aliasing: å¯ä»¥è®©åŒä¸€ä¸ª hostname åœ¨ä½œä¸º Web server å’Œä½œä¸º mail server æ—¶æŒ‡å‘ä¸åŒçš„ hostã€‚
-   load distribution: å¯ä»¥è®©åŒä¸€ä¸ª hostname æŒ‡å‘å¤šä¸ª hostï¼Œåœ¨è¿”å›æŸ¥è¯¢ç»“æœæ—¶è¿›è¡Œ rotateï¼ˆå³æ”¹å˜ä½äºé¦–ä½çš„ IP åœ°å€ï¼‰ã€‚

### Overview of How DNS Works

ç”±äºä¸‹åˆ—åŸå› ï¼ŒDNS å¿…é¡»æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå•ç‚¹å¼çš„ DNS æ— æ³• scaleï¼š

-   single point of failure
-   traffic volume è¿‡å¤§
-   ç¦»éƒ¨åˆ†ç”¨æˆ·è·ç¦»è¿‡è¿œï¼Œå¸¦æ¥è¾ƒå¤§çš„å»¶æ—¶
-   éš¾ä»¥ç»´æŠ¤ï¼ˆæ•°æ®æ€»é‡å¤§ï¼Œæ›´æ–°é¢‘ç¹ï¼‰

ä¸€èˆ¬æ¥è¯´ï¼ŒDNS åˆ†ä¸ºä»¥ä¸‹å‡ å±‚ï¼š

1.  root DNS server: åˆ†æ•£åœ¨ä¸–ç•Œå„åœ°çš„ 13 ä¸ªä¸åŒ root server å„è‡ªçš„å…±ä¸Šåƒä¸ª copyï¼Œç”¨æ¥æŸ¥è¯¢ TLD server
2.  top-level domain (TLD) server: æ¯ä¸ª TLD æœ‰è‡ªå·±çš„ TLD server (or server cluster)ï¼Œç”¨æ¥æŸ¥è¯¢ authoritative DNS server
3.  authoritative DNS server: æ¯ä¸ª subdomain æœ‰è‡ªå·±çš„ authoritative DNS serverï¼Œå¯ä»¥æ˜¯ç»„ç»‡è‡ªå·±ç»´æŠ¤çš„æˆ–è€…ç”±æœåŠ¡å•†æä¾›çš„ï¼Œç”¨æ¥æŸ¥è¯¢ hostname åˆ° IP åœ°å€çš„æ˜ å°„

é™¤æ­¤ä¹‹å¤–ï¼ŒTLD server å’Œ authoritative DNS server ä¹‹é—´è¿˜å¯èƒ½æœ‰ intermediate DNS serverã€‚

åœ¨ä¸Šè¿° DNS server çš„ hierarchy ä¹‹å¤–ï¼Œè¿˜æœ‰ local DNS serverï¼ˆå°±æ˜¯ç”µè„‘çš„ç½‘ç»œè®¾ç½®é‡Œè®¾çš„ DNS æœåŠ¡å™¨ï¼‰ï¼Œä½œä¸º proxy æ¥ä»£æ›¿ requesting host å‘ DNS server è¿›è¡ŒæŸ¥è¯¢ã€‚

ä»é€»è¾‘ä¸Šæ¥è¯´ï¼Œå‘ä¸€ä¸ª DNS server è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œå¦‚æœå®ƒè‡ªå·±ä¸çŸ¥é“æœ€ç»ˆçš„ answer (IP åœ°å€)ï¼Œå®ƒå¯ä»¥è®©ä½ æ¢ä¸€ä¸ª DNS server ç»§ç»­æŸ¥ (iterative query)ï¼Œæˆ–è€…å¸®ä½ å‘å…¶ä»– DNS server å‘é€æŸ¥è¯¢ (recursive query) ç„¶åè¿”å›æœ€ç»ˆçš„ç»“æœã€‚è€Œåœ¨å®é™…ä¸­ï¼Œå¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œä¸€èˆ¬æ˜¯å‘ local DNS server æŸ¥è¯¢æ—¶ä¼šè¿›è¡Œ recursive queryï¼Œè€Œ local DNS server å†ä» root DNS server å‘ä¸‹ç›´åˆ° authoritative DNS server è¿›è¡Œ iterative queryã€‚

ä¸ºäº†å‡å°‘æŸ¥è¯¢çš„æ•°é‡ï¼ŒDNS è®¾æœ‰ cachingã€‚æ¯ä¸ªæŸ¥è¯¢çš„å‘èµ·è€…ï¼ˆrequesting host æˆ–è€… local DNS serverï¼‰ä¼šå°†æ”¶åˆ°çš„æŸ¥è¯¢ç»“æœä¿å­˜ä¸€æ®µæ—¶é—´ï¼Œcache miss æ‰ä¼šå‘å…¶ä»– DNS server å‘èµ·æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼Œå¸¸ç”¨çš„ TLD server çš„ IP åœ°å€å¾€å¾€éƒ½åœ¨ cache ä¸­ï¼Œå¤§å¤§å‡å°‘äº† root DNS server æ”¶åˆ°çš„è¯·æ±‚æ•°é‡ã€‚

### DNS Records

DNS distributed database å­˜å‚¨çš„ä¿¡æ¯å•å…ƒæ˜¯ *resource record* (RR)ã€‚

æ¯ä¸ª RR åŒ…å« typeã€nameã€valueã€TTL å››é¡¹ä¿¡æ¯ï¼Œå…¶ä¸­ TTL è¡¨ç¤º cache å¤šä¹…è¿‡æœŸã€‚å¸¸è§çš„ type åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªï¼š

-   A: name æ˜¯ hostnameï¼Œvalue æ˜¯ IP åœ°å€ï¼Œè¡¨ç¤ºä¸€ä¸ª hostname åˆ° IP åœ°å€çš„æ˜ å°„ã€‚
-   NS: name æ˜¯ domainï¼Œvalue æ˜¯å…¶ name server çš„ hostnameï¼Œè¡¨ç¤ºå¯ä»¥åœ¨è¿™ä¸ª name server è¿›è¡Œè¿™ä¸ª domain çš„è¿›ä¸€æ­¥æŸ¥è¯¢ã€‚
-   CNAME: name æ˜¯ alias hostnameï¼Œvalue æ˜¯ canonical hostnameï¼Œç”¨æ¥æä¾› host aliasingã€‚
-   MX: name æ˜¯ alias hostnameï¼Œvalue æ˜¯ canonical hostnameï¼Œç”¨æ¥æä¾› mail server aliasingã€‚

å¯¹ä¸€ä¸ª hostname æ¥è¯´ authoritative çš„ DNS server ä¼šåŒ…å«è¢«æŸ¥è¯¢çš„ host çš„ A recordã€‚ä¸ authoritative çš„ DNS server åˆ™ä¼šåŒ…å«ç›¸åº”çš„ NS recordï¼Œä»¥åŠè¿™ä¸ª name server çš„ A recordã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š

| type |           name            |           value           |
| :--: | :-----------------------: | :-----------------------: |
|  NS  |            `.`            |   `a.root-servers.net.`   |
|  A   |   `a.root-servers.net.`   |       `198.41.0.4`        |
|  NS  |          `moe.`           |    `ns1.dns.nic.moe.`     |
|  A   |    `ns1.dns.nic.moe.`     |     `156.154.144.114`     |
|  NS  |       `ouuan.moe.`        | `amos.ns.cloudflare.com.` |
|  A   | `amos.ns.cloudflare.com.` |      `172.64.35.120`      |
|  A   |       `ouuan.moe.`        |     `172.67.181.123`      |

åœ¨ registar è´­ä¹°åŸŸåæ—¶å¯ä»¥å¡«å†™ name server çš„ä¿¡æ¯ï¼Œç”± registar è´Ÿè´£å°†ç›¸åº”çš„ NS ä»¥åŠ A record æ·»åŠ åˆ° TLD serverã€‚å¯ä»¥ä½¿ç”¨åŸŸåå•†çš„ DNS serverã€å…¶ä»–æœåŠ¡å•†ï¼ˆä¾‹å¦‚ Cloudflareï¼‰çš„ DNS server æˆ–è€…è‡ªå·±æ­å»ºçš„ DNS server ä½œä¸º authoritative DNS serverã€‚

DNS æœ€åˆåªèƒ½é™æ€æ›´æ–°ï¼ˆé€šè¿‡é…ç½®æ–‡ä»¶ç­‰æ–¹å¼ï¼‰ï¼Œåæ¥æœ‰äº† DDNS æ¥é€šè¿‡ DNS message åŠ¨æ€æ›´æ–°ã€‚

### DNS Messages

DNS message é€šè¿‡ UDP å‘é€åˆ° port 53ã€‚

DNS message çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š[^fig-2.21]

[^fig-2.21]: p133, Figure 2.21: DNS message format

![DNS message format](cnatda-fig-2.21.png)

identification ç”± client è®¾ç½®ï¼Œå³ç”¨æ¥è¯†åˆ« query å’Œ reply å¯¹åº”å…³ç³»çš„ IDã€‚

flags åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªï¼š

-   query or reply: è¿™æ¡ message æ˜¯ query è¿˜æ˜¯ reply
-   authoritative or not: è¿”å›çš„ç»“æœæ˜¯å¦æ˜¯æœ€ç»ˆçš„ç­”æ¡ˆ
-   recursion desired: client æ˜¯å¦å¸Œæœ› server è¿›è¡Œ recursive query
-   recursion available: server æ˜¯å¦å¯ä»¥è¿›è¡Œ recursive query

4 ä¸ª section ä¸­éƒ½åŒ…å«è‹¥å¹² RRã€‚

åœ¨ query ä¸­ï¼Œquestion section é‡Œä¼šåŒ…å« name å’Œ typeã€‚

å¯¹äº type A çš„æŸ¥è¯¢ï¼š

-   å¦‚æœ reply æ˜¯ authoritative çš„ï¼ˆå‘ authoritative DNS server æŸ¥è¯¢ï¼Œæˆ–è€…è¿›è¡Œäº† recursive queryï¼‰ï¼Œåˆ™ä¼šåœ¨ answer section ä¸­åˆ—å‡ºæ‰€æŸ¥è¯¢çš„ A recordã€‚
-   å¦‚æœä¸æ˜¯ authoritative çš„ï¼Œåˆ™ä¼šåœ¨ authority section ä¸­åˆ—å‡º NS recordï¼Œåœ¨ additional section ä¸­åˆ—å‡ºè¿™äº› name server çš„ A recordã€‚

åœ¨ additional section ä¸­ï¼Œè¿˜å¯èƒ½åˆ—å‡º canonical hostname çš„ A record ä¹‹ç±»çš„ã€‚

## Peer-to-Peer File Distribution

åœ¨ä¼ è¾“å¤§æ–‡ä»¶æ—¶ï¼Œclient-server çš„æ¶æ„åœ¨ç”¨æˆ·æ•°é‡å¢å¤šæ—¶éœ€è¦æ›´å¤§çš„ server bandwidth æ‰èƒ½ä¿è¯ç”¨æˆ·çš„ä¸‹è½½é€Ÿåº¦ï¼Œè€Œ P2P çš„æ¶æ„åˆ™æ˜¯ self-scalable çš„ã€‚ï¼ˆä¹¦ä¸­æœ‰ç®€åŒ–æ¨¡å‹çš„å®šé‡è®¡ç®—ã€‚ï¼‰

BitTorrent æ˜¯è¾ƒä¸ºæµè¡Œçš„ P2P file distribution protocolã€‚åœ¨ BitTorrent ä¸­ï¼Œä»¥ chunk ä¸ºä¸‹è½½æ–‡ä»¶çš„åŸºæœ¬å•ä½ã€‚ä¸€ä¸ª peer åˆšåŠ å…¥ torrent æ—¶æ²¡æœ‰ trunk æ‰€ä»¥åªèƒ½ä¸‹è½½ï¼Œåœ¨è·å–åˆ°ä¸€äº› trunk åå°±ä¼šå¼€å§‹ä¸Šä¼ ç»™å…¶ä»– peerï¼Œä¸‹è½½å®Œæˆåå¯ä»¥è‡ªç§åœ°ç¦»å¼€æˆ–è€…æ— ç§åœ°ä¿ç§ã€‚

æ¯ä¸ª torrent ä¼šæœ‰ï¼ˆè‡³å°‘ï¼‰ä¸€ä¸ª trackerï¼Œpeer åœ¨åŠ å…¥/ç¦»å¼€æ—¶ä¼šé€šçŸ¥ trackerï¼Œå¹¶åœ¨è¿‡ç¨‹ä¸­å®šæœŸå‘ŠçŸ¥ tracker è‡ªå·±ä»åœ¨æ´»åŠ¨ã€‚tracker ä¼šç»™æ¯ä¸ª peer æä¾›ä¸€äº›å…¶ä»– peer çš„ IP åœ°å€å’Œç«¯å£ã€‚

åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ª peer æ‹¥æœ‰ä¸€éƒ¨åˆ† chunkï¼Œå¹¶å‘å…¶ä»– peer è¯·æ±‚ chunkã€‚æ¯ä¸ª peer éœ€è¦å†³å®šä¼˜å…ˆä¸‹è½½å“ªä¸ª trunk ä»¥åŠä¸Šä¼ ç»™è°ã€‚

ä¼˜å…ˆä¸‹è½½çš„ trunk å¯ä»¥é‡‡ç”¨ *rarest first* çš„ç­–ç•¥ï¼Œå³ä¼˜å…ˆä¸‹è½½å·²çŸ¥çš„ peer ä¸­æ‹¥æœ‰äººæ•°æœ€å°‘çš„ chunkï¼Œè¿™æ ·çš„è¯å°±èƒ½ä½¿å¾—å„ä¸ª trunk è¾ƒä¸ºå‡åŒ€åœ°åœ¨ peer é—´åˆ†å¸ƒã€‚

åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­ï¼Œä¼šé‡‡ç”¨è¢«ç§°ä½œâ€œtit-for-tatâ€çš„ç­–ç•¥å†³å®šä¸Šä¼ ç»™è°ï¼šä¸Šä¼ ç»™è‡ªå·±ï¼ˆå³ä»ä»–é‚£ä¸‹è½½ï¼‰çš„é€Ÿåº¦æœ€å¿«çš„å‡ ä¸ª peer è¢«ç§°ä½œâ€œunchokedâ€ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜ä¼šæ¯éš”ä¸€æ®µæ—¶é—´éšæœºé€‰æ‹©ä¸€ä¸ª peer è¢«ç§°ä½œâ€œoptimistically unchokedâ€ï¼Œæœ€ååšå‡ºçš„é€‰æ‹©å°±æ˜¯ä¸Šä¼ ç»™â€œunchokedâ€å’Œâ€œoptimistically unchokedâ€çš„è¿™äº› peerã€‚è¿™ä¸ªç­–ç•¥å®é™…ä¸Šå¯ä»¥è¢«ç»•è¿‡ï¼Œä½†ä¸è¢«ç»•è¿‡æ—¶å®ƒæä¾›äº†ä¸€ä¸ªæ¿€åŠ±å¤§å®¶ä¸Šä¼ çš„æœºåˆ¶ã€‚ï¼ˆæ³¨ï¼šåœ¨ä¸‹è½½å®Œæ¯•åä¿ç§æ—¶ï¼Œä¼šä½¿ç”¨å¦å¤–çš„ç­–ç•¥ã€‚[^seed-choking]ï¼‰

[^seed-choking]: [seed_choking_algorithm - libtorrent](https://www.libtorrent.org/reference-Settings.html#seed_choking_algorithm_t)

é™¤äº†é€šè¿‡ trackerï¼Œè¿˜å¯ä»¥é€šè¿‡ Distributed Hash Table (DHTï¼Œä¸€ç§ P2P æ¶æ„çš„ distributed database) æ¥è·å– peerã€‚

## Video Streaming and Content Distribution Networks

### HTTP Streaming and DASH

è§†é¢‘éœ€è¦è€—è´¹å¤§é‡çš„æµé‡ï¼ˆä»¥åŠå­˜å‚¨ç©ºé—´ï¼‰ï¼Œè€Œ streaming æ—¶éœ€è¦ä¿è¯è‡³å°‘æœ‰è§†é¢‘ bitrate è¿™ä¹ˆå¤šçš„å¸¦å®½æ‰èƒ½é¿å…å¡é¡¿ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šæ ¹æ®å¯ç”¨çš„å¸¦å®½é€‰æ‹©ä¸åŒè´¨é‡çš„è§†é¢‘ç‰ˆæœ¬ã€‚

æœ€åŸºç¡€çš„ streaming æ–¹å¼æ˜¯ HTTP streamingï¼Œå³é€šè¿‡ HTTP GET è·å–è§†é¢‘æ–‡ä»¶è‡³ç¼“å†²åŒºå¹¶æ’­æ”¾ï¼Œä½†è¿™æ ·æ— æ³•é€‚åº”ä¸åŒç”¨æˆ·çš„ä¸åŒå¸¦å®½ï¼Œæ›´æ— æ³•é€‚åº”åŒä¸€ä¸ªç”¨æˆ·éšæ—¶é—´å˜åŒ–çš„å¸¦å®½ã€‚

åœ¨ Dynamic Adaptive Streaming over HTTP (DASH) ä¸­ï¼Œè§†é¢‘è¢«ç¼–ç ä¸ºå¤šä¸ªä¸åŒè´¨é‡çš„ç‰ˆæœ¬ï¼Œclient æ¯æ¬¡è·å–ä¸€ä¸ªå‡ ç§’çš„è§†é¢‘ç‰‡æ®µï¼Œå¹¶æ ¹æ®å¯ç”¨å¸¦å®½åŠ¨æ€è°ƒæ•´é€‰æ‹©çš„ç‰ˆæœ¬ã€‚

åœ¨å¼€å§‹æ’­æ”¾ä¹‹å‰ï¼Œclient é¦–å…ˆä¼šè·å– manifest file æ¥å¾—åˆ°å„ä¸ªè§†é¢‘ç‰ˆæœ¬çš„ URL ä»¥åŠ bitrateã€‚åœ¨æ’­æ”¾è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ HTTP GET è¯·æ±‚ä»¥åŠ byte range header è·å–è§†é¢‘ç‰‡æ®µï¼ŒåŒæ—¶è®¡ç®—å¯ç”¨å¸¦å®½ï¼Œå†³å®šæ¥ä¸‹æ¥é€‰æ‹©çš„è§†é¢‘ç‰ˆæœ¬ã€‚

### Content Distribution Networks

å’Œ DNS ç±»ä¼¼ï¼Œvideo streaming å¾€å¾€ä¹Ÿä¸èƒ½ä»…é€šè¿‡å•ä¸ª data center å®ç°ï¼Œå› ä¸ºï¼š

-   ç¦»éƒ¨åˆ†ç”¨æˆ·è¿‡è¿œï¼Œè™½ç„¶ streaming å¯¹å»¶æ—¶è¦æ±‚ä¸é«˜ï¼Œä½†æ›´å¤šçš„ communication link å¾ˆå¯èƒ½æ„å‘³ç€æ›´ä½çš„ bottleneck bandwidthã€‚
-   åŒä¸€ä¸ªè§†é¢‘ä¼šåœ¨åŒä¸€ä¸ª communication link ä¸Šè¢«ä¼ è¾“å¤šæ¬¡ï¼Œé€ æˆç½‘ç»œèµ„æºä»¥åŠèµ„è´¹çš„æµªè´¹ã€‚
-   single point of failure

ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œvideo-streaming company å¾€å¾€ä¼šä½¿ç”¨ Content Distribution Networks (CDN) æ¥åˆ†å‘è§†é¢‘ã€‚

CDN ä¼šåœ¨å…¨çƒå„åœ°æ”¾ç½® server (cluster)ï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹å­˜æ”¾ä¸€ä»½ content çš„ copyï¼Œåœ¨å¤„ç† user request æ—¶å°½é‡ç”±æœ€å¥½ï¼ˆæœ€è¿‘ï¼‰çš„èŠ‚ç‚¹è´Ÿè´£å“åº”ã€‚

CDN å¯ä»¥æ˜¯ private CDNï¼ˆä¾‹å¦‚ Google çš„ CDNï¼‰æˆ–è€… third-party CDNï¼ˆä¾‹å¦‚ Akamaiã€Limelightã€Level-3ï¼Œ~~ä¹¦ä¸­ç«Ÿç„¶æ²¡æåˆ° Cloudflare~~ï¼‰ã€‚

CDN é€šå¸¸æœ‰ä¸¤ç§æ”¾ç½®ç­–ç•¥ï¼š

-   Enter Deep: æ”¾åœ¨ access ISPï¼Œcluster æ•°é‡å¤šï¼Œæ€§èƒ½æ›´å¥½ï¼Œç»´æŠ¤æˆæœ¬æ›´é«˜ã€‚
-   Bring Home: æ”¾åœ¨ IXPï¼Œcluster æ•°é‡å°‘ï¼Œç»´æŠ¤æˆæœ¬æ›´ä½ï¼Œæ€§èƒ½ç›¸å¯¹å·®ã€‚

CDN çš„æ›´æ–°æœ‰ push å’Œ pull ä¸¤ç§æ–¹å¼ï¼Œpush å°±æ˜¯å†…å®¹æ›´æ–°æ—¶ push åˆ°å„ä¸ª clusterï¼Œpull åˆ™ä¸ cache ç±»ä¼¼ï¼Œåœ¨ cache miss æ—¶å†ä»ä¸Šæ¸¸è·å–å¹¶ï¼ˆåœ¨ stream ç»™ç”¨æˆ·çš„åŒæ—¶ï¼‰ä¿å­˜ä¸‹æ¥ã€‚

å°†ç”¨æˆ·é‡å®šå‘åˆ° CDN èŠ‚ç‚¹çš„ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ DNSï¼šauthoritative DNS server è¿”å› CDN çš„ DNS server çš„ NS recordï¼Œç„¶åå†ç”± CDN çš„ DNS server è¿›è¡ŒèŠ‚ç‚¹é€‰æ‹©å¹¶è¿”å›èŠ‚ç‚¹çš„ IP åœ°å€ã€‚

ï¼ˆåŸºäº DNS è¿›è¡Œ CDN é‡å®šå‘æ—¶ï¼‰ï¼Œé€‰æ‹©èŠ‚ç‚¹çš„ä¸¤ç§æ–¹å¼æ˜¯ï¼š

-   geographically closest: ç”± local DNS server çš„ IP ç¡®å®šåœ°ç†ä½ç½®ï¼Œç„¶åé€‰æ‹©æœ€è¿‘çš„èŠ‚ç‚¹ã€‚è¿™æ ·åšçš„ä¸»è¦é—®é¢˜åœ¨äºï¼Œåœ°ç†ä½ç½®è¿‘ä¸ä¸€å®šæ„å‘³ç€ç½‘ç»œè·ç¦»è¿‘/å¸¦å®½é«˜ï¼Œå¹¶ä¸” local DNS server æœ‰å¯èƒ½ç¦»ç”¨æˆ·å¾ˆè¿œã€‚

-   real-time measurements: å¯ä»¥æ¯éš”ä¸€æ®µæ—¶é—´å‘å„ä¸ª local DNS server å‘é€æ¢æµ‹ä¿¡å·æ¥æ£€æµ‹ç½‘ç»œæ€§èƒ½ï¼Œè¿™æ ·åšçš„ä¸»è¦é—®é¢˜åœ¨äº DNS server å¯èƒ½ä¼šæ‹’ç»å“åº”è¿™æ ·çš„æ¢æµ‹ã€‚

### Case Studies: Netflix and YouTube

Netflix å’Œ YouTube éƒ½æ˜¯å¤§å‹ video streaming æœåŠ¡å•†ï¼Œä½†å®ƒä»¬çš„æ¶æ„æœ‰å¾ˆå¤§ä¸åŒï¼Œè¿™å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç”±äºå®ƒä»¬è§†é¢‘ç±»å‹çš„ä¸åŒï¼ˆå‰§ vs UGCï¼‰ã€‚

#### Netflix

Netflix ä½¿ç”¨ Amazon cloud è¿è¡Œ Web server ä»¥åŠè§†é¢‘å¤„ç†ï¼Œè€Œä½¿ç”¨ç§æœ‰çš„ CDN åˆ†å‘è§†é¢‘ã€‚

Netflix çš„ç§æœ‰ CDN cluster å®‰è£…åœ¨ ISP å’Œ IXP ä¸­ï¼Œå…¶ä¸­ IXP çš„ cluster å¾€å¾€å®¹é‡è¾ƒå¤§ï¼Œå¯ä»¥è£…ä¸‹æ•´ä¸ª Netflix çš„æ‰€æœ‰è§†é¢‘çš„å„ä¸ªç‰ˆæœ¬ï¼Œè€Œ ISP çš„ cluster å¾€å¾€å®¹é‡è¾ƒå°ï¼Œåªå­˜æ”¾æœ€çƒ­é—¨çš„è§†é¢‘ã€‚

Netflix ä¸ä½¿ç”¨ pull-cachingï¼Œè€Œæ˜¯åœ¨æ¯å¤©çš„ä½å³°æœŸé‡‡ç”¨ push è¿›è¡Œæ›´æ–°ã€‚

å› ä¸º Netflix çš„ç§æœ‰ CDN åªè´Ÿè´£åˆ†å‘è§†é¢‘ï¼Œå®ƒä¸éœ€è¦ä½¿ç”¨ DNS redirectï¼Œç›´æ¥ç”± Web server å‘Šè¯‰ client IP åœ°å€å³å¯ã€‚

#### YouTube

<Card title="Google çš„ network infrastructure">

Google éƒ¨ç½²äº†ä¸€ä¸ªåºå¤§çš„ private network and CDN infrastructureï¼ŒåŒ…å«ä»¥ä¸‹ä¸‰çº§ server clustersï¼š

1.  çº¦ 20 ä¸ªâ€œmega data centerâ€ï¼Œåˆ†å¸ƒåœ¨åŒ—ç¾ã€æ¬§æ´²å’Œäºšæ´²ï¼Œæ¯ä¸ª cluster æœ‰æ•°åä¸‡æœåŠ¡å™¨ï¼Œç”¨æ¥ serve dynamic contentã€‚
2.  çº¦ 90 ä¸ªéƒ¨ç½²åœ¨ IXP çš„ clusterï¼Œæ¯ä¸ª cluster æœ‰æ•°ç™¾ä¸ªæœåŠ¡å™¨ï¼Œç”¨æ¥ serve åŒ…æ‹¬ YouTube è§†é¢‘åœ¨å†…çš„ static contentã€‚
3.  æ•°ç™¾ä¸ªéƒ¨ç½²åœ¨ access ISP çš„ clusterï¼Œæ¯ä¸ª cluster æœ‰æ•°åä¸ªæœåŠ¡å™¨ï¼Œç”¨æ¥è¿›è¡Œ TCP splitting ä»¥åŠ server static contentï¼Œä¾‹å¦‚ç½‘é¡µä¸Šçš„é™æ€èµ„æºã€‚

åœ¨è®¿é—® Google çš„æœåŠ¡æ—¶ï¼Œä¸åŒå†…å®¹å¾€å¾€ä¼šæ¥è‡ªä¸åŒå±‚çº§çš„ clusterã€‚

è¿™äº› cluster é€šè¿‡ Google çš„ private network è¿æ¥ï¼Œä½¿å¾—å®ƒä»¬ä¹‹é—´çš„å¾ˆå¤šé€šä¿¡éƒ½ä¸ä¾èµ–äº public Internetï¼Œä¸ç”¨æˆ·çš„é€šä¿¡ä¹Ÿå¾€å¾€åªæ¶‰åŠåˆ° access ISP è¿™ä¸€å±‚ã€‚

</Card>

YouTube ä½¿ç”¨ Google çš„ç§æœ‰ CDN åˆ†å‘è§†é¢‘ï¼Œå¹¶ä¸”ä½¿ç”¨ pull-caching å’Œ DNS redirectã€‚åœ¨é€‰æ‹©èŠ‚ç‚¹æ—¶ï¼Œä¼šç»¼åˆè€ƒè™‘ client åˆ° cluster çš„ RTT ä»¥åŠè´Ÿè½½å‡è¡¡ã€‚

åœ¨ç”¨æˆ·ä¸Šä¼ è§†é¢‘æ—¶ï¼Œä¼šåœ¨ Google çš„ data center è¿›è¡Œå¤„ç†ã€‚

## Socket Programming: Creating Network Applications

ä¸€èˆ¬æ¥è¯´ï¼Œç¼–å†™ network application éœ€è¦ç¼–å†™ client program å’Œ server programã€‚

### Socket Programming with UDP

ä½¿ç”¨ UDP æ—¶ï¼Œæ¯æ¬¡å‘é€ datagram[^datagram] éƒ½éœ€è¦æŒ‡å®š addressï¼ˆIP åœ°å€ & ç«¯å£ï¼‰ï¼Œæ¥æ”¶ datagram æ—¶ä¹Ÿä¼šæ”¶åˆ°å¯¹æ–¹çš„ addressã€‚

[^datagram]: åœ¨ä¹¦ä¸­ 1.5 èŠ‚ï¼Œtransport-layer packet è¢«ç§°ä½œ â€œsegmentâ€ï¼Œnetwork-layer packet è¢«ç§°ä½œ â€œdatagramâ€ï¼Œä½†å®é™…ä¸Š UDP çš„ â€œDâ€ å°±æ˜¯ â€œdatagramâ€ï¼Œè€Œ TCP çš„ packet æ‰å« â€œsegmentâ€ã€‚ref: [networking - Definition of Network Units: Fragment, Segment, Packet, Frame, Datagram - Stack Overflow](https://stackoverflow.com/questions/11636405/definition-of-network-units-fragment-segment-packet-frame-datagram)

~~ä¸€çœ‹å°±æ‡‚ä½†ä¹¦ä¸Šè§£é‡Šäº†åŠå¤©çš„~~ ä¾‹å­ï¼š

```python
from socket import *
serverName = 'hostname'
serverPort = 12000
clientSocket = socket(AF_INET, SOCK_DGRAM) # AF_INET è¡¨ç¤º IPv4 åœ°å€ï¼ŒSOCK_DGRAM è¡¨ç¤º UDP
message = input('Input lowercase sentence:')
clientSocket.sendto(message.encode(), (serverName, serverPort))
modifiedMessage, serverAddress = clientSocket.recvfrom(2048) # 2048 æ˜¯ buffer size
print(modifiedMessage.decode())
clientSocket.close()
```

```python
from socket import *
serverPort = 12000
serverSocket = socket(AF_INET, SOCK_DGRAM)
serverSocket.bind(('', serverPort))
print('The server is ready to receive')
while True:
    message, clientAddress = serverSocket.recvfrom(2048)
    modifiedMessage = message.decode().upper()
    serverSocket.sendto(modifiedMessage.encode(), clientAddress)
```

### Socket Programming with TCP

TCP æ˜¯ä¸€ä¸ª connection-oriented protocolï¼Œåœ¨ server ä¸Šåˆ†ä¸º welcoming socket å’Œ connection socketï¼Œä¸€å¼€å§‹éœ€è¦é€šè¿‡ welcoming socket å»ºç«‹ connection å¹¶å¾—åˆ° connection socketï¼Œè€Œåœ¨å»ºç«‹äº† connection ä¹‹åå°±æ— éœ€å†æŒ‡å®šå¯¹æ–¹çš„ addressã€‚

ï¼ˆä¸‹é¢çš„ä»£ç é™¤äº†æ¢æˆ TCP è¿˜å¯¹ä¸Šé¢çš„ UDP ä»£ç æœ‰è‹¥å¹²æ²¡æœ‰æœ¬è´¨åŒºåˆ«çš„ä¿®æ”¹ï¼Œè¦æ˜¯æˆ‘å†™è‚¯å®šä¼šé¿å…ï¼Œä½†æ˜¯ä»ä¹¦ä¸Šå¤åˆ¶å°±æ‡’å¾—æ”¹äº†ã€‚ï¼‰

```python
from socket import *
serverName = 'servername'
serverPort = 12000
clientSocket = socket(AF_INET, SOCK_STREAM) # SOCK_STREAM æ˜¯ TCP
clientSocket.connect((serverName, serverPort))
sentence = input('Input lowercase sentence:')
clientSocket.send(sentence.encode())
modifiedSentence = clientSocket.recv(1024)
print('From Server: ', modifiedSentence.decode())
clientSocket.close()
```

```python
from socket import *
serverPort = 12000
serverSocket = socket(AF_INET, SOCK_STREAM)
serverSocket.bind(('', serverPort))
serverSocket.listen(1) # 1 æ˜¯ connection queue çš„æœ€å¤§é•¿åº¦
print('The server is ready to receive')
while True:
    connectionSocket, addr = serverSocket.accept()
    sentence = connectionSocket.recv(1024).decode()
    capitalizedSentence = sentence.upper()
    connectionSocket.send(capitalizedSentence.encode())
    connectionSocket.close()
```
