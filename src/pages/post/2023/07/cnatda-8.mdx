---
title: CNATDA ç¬¬å…«ç« å­¦ä¹ ç¬”è®°
date: 2023-07-17T19:47:50+08:00
image: cnatda-8.png
tags:
-   cnatda
-   å­¦ä¹ ç¬”è®°
-   WIP
---

ã€ŠComputer Networking: A Top-Down Approach (8th Edition)ã€‹ç¬¬å…«ç«  â€œSecurity in Computer Networksâ€ çš„å­¦ä¹ ç¬”è®°ã€‚

<Excerpt />

## What Is Network Security?

*secure communication* æœ‰ä¸‹åˆ—æ€§è´¨ï¼š

-   confidentiality: ç”±äºé€šä¿¡å¯ä»¥è¢«æ‹¦æˆªï¼Œä¿å¯†æ„å‘³ç€éœ€è¦ä»¥æŸç§æ–¹å¼åŠ å¯†
-   message integrity: ä¿è¯æ¶ˆæ¯æœªè¢«ä¿®æ”¹
-   end-point authentication: èƒ½å¤Ÿç¡®è®¤å¯¹æ–¹çš„èº«ä»½
-   operational security: ä¿æŠ¤ organization network ä¸è¢«æ”»å‡»

intruder å¯ä»¥å¯¹ message è¿›è¡Œ eavesdroppingã€modificationã€insertionã€deletionï¼Œè¿›è€Œå®ç°å„ç§æ”»å‡»ã€‚

åœ¨ç½‘ç»œä¸­ï¼Œéœ€è¦è¿›è¡Œ secure communication çš„åŒæ–¹å¯èƒ½æ˜¯ä¸¤ä¸ªäººç±»ç”¨æˆ·ã€å¯èƒ½æ˜¯ client å’Œ serverã€å¯èƒ½æ˜¯ä¸¤ä¸ª routerâ€¦â€¦

security functionality å¯ä»¥åœ¨ç½‘ç»œçš„å„ä¸ª layer æä¾›ã€‚è™½ç„¶åº•å±‚çš„ security çœ‹èµ·æ¥è¦†ç›–äº†é«˜å±‚çš„ securityï¼Œä½†å¹¶éå®Œå…¨å¦‚æ­¤ï¼Œä¾‹å¦‚ IP-layer security ä¸èƒ½åŒºåˆ† IP address ç›¸åŒçš„å¤šä¸ªç”¨æˆ·ã€‚å¹¶ä¸”ï¼Œåº•å±‚åè®®çš„æ›´æ–°ã€æ™®åŠç›¸å¯¹æ›´æ…¢ï¼Œåœ¨ä¸Šå±‚é‡‡å–æªæ–½å¯ä»¥æ›´å¿«ç”Ÿæ•ˆã€‚

## Principles of Cryptography

plaintext (cleartext) ç» encryption algorithm å¾—åˆ° ciphertextï¼Œç”± decryption algorithm å›åˆ° plaintextã€‚

encryption algorithm ä¸€èˆ¬æ˜¯å…¬å¼€çš„ï¼Œä¸ºäº†è¾¾åˆ°ä¿å¯†çš„æ•ˆæœï¼Œè¿˜éœ€è¦ä½¿ç”¨ keyã€‚è®¾ plaintext æ˜¯ $m$ï¼Œsender ä½¿ç”¨ key $K_A$ è¿›è¡Œ encrypt å¾—åˆ° $K_A(m)$ï¼Œreceiver ä½¿ç”¨ key $K_B$ è¿›è¡Œ decrypt å¾—åˆ° $K_B(K_A(m)) = m$ã€‚

åœ¨ symmetric key system ä¸­ï¼Œ$K_A = K_B$ï¼Œæ˜¯ä¿å¯†çš„ï¼›åœ¨ public key system ä¸­ï¼Œ$K_A$ æ˜¯å…¬å¼€çš„ï¼Œ$K_B$ æ˜¯ä¿å¯†çš„ã€‚

### Symmetric Key Cryptography

åœ¨ç°ä»£å¯†ç æ‰€ä½¿ç”¨çš„ block cipher ä¸­ï¼Œplaintext è¢«åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ª blockï¼Œä¾‹å¦‚åœ¨ AES ä¸­æ¯ 128 bit æ˜¯ä¸€ä¸ª blockï¼Œcipher ä¼šæ„å»ºä¸€ä¸ª $2^{128} \to 2^{128}$ çš„ plaintext åˆ° ciphertext çš„ä¸€ä¸€å¯¹åº”ï¼Œè€Œ key ç”¨æ¥ç”Ÿæˆè¿™ä¸ªå¯¹åº”å…³ç³»ï¼ŒAES çš„ key length å¯ä»¥æ˜¯ 128/192/256 bitã€‚å¤ªå°çš„ block size / key length ä¼šå¯¼è‡´å®‰å…¨æ€§ä¸å¤Ÿï¼›å°†æ•´ä¸ªå¯¹åº”å…³ç³»å­˜ä¸‹æ¥ key ä¼šè¿‡é•¿ï¼Œæ‰€ä»¥åªèƒ½ç”¨æ²¡é‚£ä¹ˆé•¿çš„ key æ¥ç”Ÿæˆå¯¹åº”å…³ç³»ï¼›å¤ªå¤§çš„ block size / key length å¯èƒ½ä¼šå½±å“æ€§èƒ½ã€‚

å¦‚æœ plaintext ä¸­æœ‰å¤šä¸ªç›¸åŒçš„ blockï¼Œå®ƒä»¬å¯¹åº”çš„ ciphertext ä¹Ÿç›¸åŒï¼Œå°±ä¼šæš´éœ²å‡ºä¸€å®šçš„ä¿¡æ¯ã€‚ä¸ºäº†é¿å…è¿™æ ·çš„é£é™©ï¼Œå¯ä»¥ç»™æ¯ä¸ª block å¼‚æˆ–ä¸Šä¸€ä¸ªéšæœºæ•°å†åŠ å¯†ã€‚

å¦‚æœçœŸçš„æ¯ä¸ª block éƒ½ç‹¬ç«‹åœ°ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œåˆ™ä¼ è¾“æ—¶éœ€è¦é™„ä¸Šè¿™ä¸€å †éšæœºæ•°ï¼Œæ•´ä¸ª message çš„é•¿åº¦ä¼šç¿»å€ã€‚æ‰€ä»¥å®é™…ä¸Šå¹¶ä¸ä¼šè¿™æ ·åšï¼Œè€Œæ˜¯ä¼šä½¿ç”¨ç§°ä½œ cipher block chaining (CBC) çš„æŠ€æœ¯ï¼šæ¯æ¡ message åªç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œç§°ä½œ initialization vector (IV)ï¼Œè®°ä½œ $c_0$ï¼Œè€Œ plaintext çš„ç¬¬ä¸€å—è®°ä½œ $m_1$ï¼Œå¯¹ $c_{i-1} \oplus m_i$ åŠ å¯†å¾—åˆ° $c_i$ï¼Œå³æ¯ä¸ª block å¼‚æˆ–çš„æ˜¯ä¸Šä¸€ä¸ª block çš„åŠ å¯†ç»“æœï¼Œè¿™æ ·ä¼ è¾“æ—¶çš„ overhead å°±åªæœ‰ä¸€ä¸ª block size çš„ IV äº†ã€‚

### Public Key Encryption

symmetric key cryptography éœ€è¦åŒæ–¹ä»¥æŸç§æ–¹å¼äº‹å…ˆåšåˆ°å…±äº« keyï¼Œè€Œè¿™æœ¬èº«å°±éœ€è¦ secure communicationã€‚ä»¥å‰è¿™å¯ä»¥é€šè¿‡çº¿ä¸‹ä¹‹ç±»çš„æ–¹å¼è¿›è¡Œï¼Œè€Œåœ¨ç½‘ç»œä¸­åˆ™éœ€è¦å¦å¤–çš„æ–¹å¼ã€‚

åœ¨ public key encryption ä¸­ï¼Œæ¥æ”¶æ–¹æœ‰ä¸€å¯¹ keyï¼Œpublic key ç”¨æ¥åŠ å¯†ï¼Œprivate key ç”¨æ¥è§£å¯†ã€‚public key æ˜¯å…¬å¼€çš„ï¼Œä»è€Œä¸éœ€è¦äº‹å…ˆä¾èµ–äº secure communication è¿›è¡Œ key exchangeã€‚

public key encryption å¸¦æ¥èº«ä»½è®¤è¯çš„é—®é¢˜ï¼šåœ¨ symmetric key cryptography ä¸­ï¼ŒçŸ¥é“ key éšå«äº†èº«ä»½ï¼Œä½†çŸ¥é“ public key åˆ™ä¸ä»£è¡¨èº«ä»½ï¼Œæ‰€ä»¥éœ€è¦é¢å¤–çš„æœºåˆ¶æ¥è¿›è¡Œè®¤è¯ã€‚

RSA æ˜¯ç›®å‰æœ€æµè¡Œçš„ public key encryption algorithm:

1.  é€‰ä¸¤ä¸ªå¤§è´¨æ•° $p$ å’Œ $q$ï¼ˆä¸€èˆ¬è¦è¾¾åˆ° 1024\~4096 bit é•¿ï¼‰
2.  ä»¤ $n = pq$ï¼Œ$z = (p-1)(q-1)$
3.  é€‰ä¸€ä¸ªæ¯” $n$ å°ã€å’Œ $z$ äº’è´¨çš„æ•° $e$
4.  ç®—å‡º $e$ çš„ä¹˜æ³•é€†å…ƒ $d = e^{-1} \bmod z$
5.  public key æ˜¯ $(n, e)$ï¼Œprivate key æ˜¯ $(n, d)$
6.  encryption: è®¾ plaintext æ˜¯ $m$ ($m < n$)ï¼Œåˆ™ ciphertext æ˜¯ $c = m^e \bmod n$
7.  decryption: $m = c^d \bmod n$

RSA çš„è®¡ç®—æ¯” AES æ…¢ï¼Œä¸ºäº†æ€§èƒ½ï¼Œé€šå¸¸ä¼šç»“åˆ symmetric key cryptography ä¸€èµ·ä½¿ç”¨ï¼šæ¯æ¬¡ç”Ÿæˆä¸€ä¸ªç”¨äº symmetric key cipher çš„ session keyï¼Œé€šè¿‡ public key encryption æ¥è¿›è¡Œ key exchangeï¼Œå®é™…çš„é€šä¿¡åˆ™ä½¿ç”¨ symmetric key cipherã€‚

RSA çš„å®‰å…¨æ€§ä¾èµ–äºå¤§æ•°åˆ†è§£çš„å›°éš¾æ€§ï¼Œè¿™å—åˆ°é‡å­è®¡ç®—çš„æŒ‘æˆ˜ã€‚

## Message Integrity and Digital Signatures

message integrity å³ sender èº«ä»½çœŸå®ï¼Œmessage æœªé­ç¯¡æ”¹ã€‚

cryptographic hash function åœ¨ä¸€èˆ¬çš„ hash çš„åŸºç¡€ä¸Šè¦æ±‚éš¾ä»¥æ„é€  collisionï¼Œä»è€Œå¯ä»¥ç”¨æ¥éªŒè¯æ¶ˆæ¯æœªè¢«ç¯¡æ”¹ã€‚

å¯ä»¥ç”¨ message authentication code (MAC) æ¥éªŒè¯ message integrityï¼šåŒæ–¹å…±äº«ä¿å¯†çš„ authentication keyï¼Œè®¾ message æ˜¯ $m$ï¼Œcryptographic hash function æ˜¯ $H$ï¼Œæœ€ç»ˆä¼ è¾“çš„æ˜¯ $(m, H(m + s))$ï¼ˆå…·ä½“å®ç°å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œä¾‹å¦‚ HMAC ä¼š hash ä¸¤æ¬¡ï¼‰ã€‚å¯ä»¥ä½¿ç”¨ public key encryption æˆ–è€…å…¶ä»–æ–¹å¼æ¥ exchange authentication keyã€‚MAC æœ¬èº«å¯ä»¥ä¸æ¶‰åŠ encryptionï¼Œå¦‚æœåªéœ€ä¿è¯ message integrity è€Œä¸åœ¨æ„ confidentiality åˆ™æ— éœ€ä»˜å‡º encryption çš„æ€§èƒ½ä»£ä»·ã€‚

digital signature ç›¸å½“äº MAC çš„ â€œpublic key ç‰ˆæœ¬â€ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯ sender çš„èº«ä»½ï¼Œè€ŒéªŒè¯è€…åªéœ€çŸ¥é“ public keyï¼Œå¯ä»¥ä¿æŒ private key çš„ç§å¯†ã€‚RSA çš„ encryption å’Œ decryption å…¶å®æ˜¯å¯äº¤æ¢çš„ï¼Œå³å…ˆ public key å† private key æˆ–è€…å…ˆ private key å† public key éƒ½å¯ä»¥å¾—åˆ°åŸæ¥çš„ plaintextã€‚digital signature å³ä½¿ç”¨ private key è¿›è¡Œâ€œåŠ å¯†â€ï¼Œè€Œä½¿ç”¨ public key è¿›è¡Œâ€œè§£å¯†â€ã€‚RSA è®¡ç®—æ…¢ï¼Œæ‰€ä»¥å¯ä»¥å¯¹ cryptographic hash è€Œé message æœ¬èº«è®¡ç®— digital signatureã€‚

è™½ç„¶ MAC å’Œ digital signature åŠŸèƒ½æœ‰ä¸€å®šçš„ç±»ä¼¼ï¼Œä½† MAC å¯ä»¥å®Œå…¨ä¸æ¶‰åŠ encryptionï¼Œdigital signature åˆ™ä¾èµ–äº public key infrastructure (PKI)ã€‚

digital signature éªŒè¯çš„æ˜¯ message å’Œ public key çš„å¯¹åº”å…³ç³»ï¼Œè¿˜éœ€è¦é¢å¤–çš„æªæ–½æ¥ä¿è¯ public key å’Œ entity (sender) çš„å¯¹åº”å…³ç³»ã€‚certification authority (CA) æä¾›äº†è¿™ä¸€æœåŠ¡ï¼Œé€šè¿‡æŸäº›æ‰‹æ®µè®¤è¯ public key å’Œ entity çš„å¯¹åº”å…³ç³»ï¼Œå¹¶é¢å‘ certificateï¼Œcertificate åŒ…å« entity å’Œ public key çš„ç›¸å…³ä¿¡æ¯ï¼ˆä»¥åŠæœ‰æ•ˆæœŸï¼‰ä»¥åŠä½¿ç”¨ CA çš„ public key å¯¹è¿™äº›ä¿¡æ¯åˆ›å»ºçš„ digital signatureã€‚æœ‰äº† certificateï¼Œå¯¹ public key å’Œ entity ä¹‹é—´å…³è”çš„ä¿¡ä»»å–å†³äºå¯¹ CA çš„ä¿¡ä»»ã€‚

## End-Point Authentication

ä¹¦ä¸Šè¯´äº†å¾ˆå¤šï¼Œä½†æ„Ÿè§‰æœ¬è´¨ä¸Šå°±æ˜¯ï¼ŒAlice è¦å‘ Bob è¯æ˜è‡ªå·±çš„èº«ä»½ï¼Œåˆ™ Bob æä¾›ä¸€ä¸ªä¸€æ¬¡æ€§çš„éšæœºæ•° *nonce*ï¼ŒAlice é€šè¿‡æŸç§æ–¹å¼ï¼ˆä¾‹å¦‚ symmetric key cryptography / MACï¼‰å‘å› nonce å¹¶ä¿è¯ message integrityã€‚nonce ç”¨æ¥é˜²æ­¢ playback attackã€‚

## Securing E-Mail

### Secure E-Mail

å°±æ˜¯ä¸Šé¢è¿™äº›ä¸œè¥¿çš„ä¸€ä¸ªå®ä¾‹ï¼Œæ²¡å•¥æ–°ä¸œè¥¿ï¼šç»“åˆ digital signature å’Œä½¿ç”¨ session key çš„ encryption å³å¯ï¼›éœ€è¦åŒæ–¹äº’ç›¸çŸ¥é“å¯¹æ–¹çš„ public keyï¼ˆåˆ†åˆ«ç”¨äº digital signature çš„éªŒè¯å’Œ session key çš„ä¼ è¾“ï¼‰ï¼Œpublic key å¯ä»¥ç”± CA è®¤è¯ã€‚

ï¼ˆå¥½æ€ªï¼Œä¸ºå•¥ä¸è®² SPFã€DKIMã€DMARCã€‚ï¼‰

### PGP

PGP æä¾›äº† signã€encryptã€sign and encrypt ç­‰åŠŸèƒ½ï¼Œpublic key é€šè¿‡ç”¨æˆ·ä¹‹é—´çš„ web of trust è€Œé CA æ¥ certifyï¼Œå¯ä»¥çº¿ä¸‹ä¸¾åŠ key-signing party æ¥äº’ç›¸ sign[^sign]ã€‚

[^sign]: P.S. æˆ‘æœ‰å¹¸åœ¨ [ç¬¬ä¸€æ¬¡å‚åŠ  tunight](https://tuna.moe/event/2021/welcome-and-debian/) æ—¶è·å¾—äº†ç»­è€å¸ˆçš„ signingï¼Œå½“æ—¶è¿˜å®Œå…¨ä¸æ‡‚è¿™äº›ï¼ˆ~~ç°åœ¨ä¹Ÿä¸æ˜¯å¾ˆæ‡‚ï¼ˆ~~

## Securing TCP Connections: TLS

TLS (Transport Layer Security) ä¸º TCP æä¾›äº† security servicesï¼Œæ˜¯ SSL (Secure Sockets Layer) æ ‡å‡†åŒ–åçš„å‡çº§ç‰ˆï¼ˆåªä¸è¿‡ç°åœ¨äººä»¬æœ‰æ—¶ä»ä¼šæŠŠ TLS è¯¯ç§°ä¸º SSLï¼ŒOpenSSL çš„åå­—ä¹Ÿæœ‰ä¸€å®šçš„è¯¯å¯¼æ€§[^opentls]ï¼‰ã€‚

[^opentls]: See [Rename OpenSSL to OpenTLS To Comply with RFC7568 Â· Issue #6384 Â· openssl/openssl](https://github.com/openssl/openssl/issues/6384) & [Celebrating 20 Years of OpenSSL - OpenSSL Blog](https://www.openssl.org/blog/blog/2018/12/20/20years/)

TLS é€šå¸¸ç”¨äº HTTPï¼Œè¡¨ç°ä¸ºç½‘å€å¼€å¤´æ˜¯ `https://`ï¼Œä½†å®ƒå®é™…ä¸Šå¯ä»¥ç”¨äºä»»ä½•åŸºäº TCP çš„ applicationã€‚TLS ä½äº application layerï¼Œä½†å®ƒæä¾›äº†ç±»ä¼¼ TCP çš„ APIï¼Œå¯¹äº application developer æ¥è¯´å°±åƒæ˜¯ transport layer çš„ä¸€éƒ¨åˆ†ã€‚

### TLS Handshake

1.  TCP 3-way handshake
2.  client å‘é€ TLS versionã€supported cipher suites (symmetric algorithmã€public key algorithmã€HMAC algorithm)ã€client nonceã€‚
3.  server å‘é€ selected cipher suiteã€certificateã€server nonceã€‚
4.  client éªŒè¯ certificateï¼Œå¾—åˆ° server çš„ public keyï¼›éšæœºç”Ÿæˆ pre-master secret (PMS)ï¼Œå‘é€ç» server çš„ public key åŠ å¯†çš„ PMSã€‚
5.  ç”± PMSã€client nonceã€server nonce å¯ä»¥è®¡ç®—å¾—åˆ° master keyï¼Œç”± master key å¯ä»¥å¾—åˆ°ä¸€ç³»åˆ—ç”¨äºåç»­åŠ å¯†çš„ keyï¼šclient å’Œ server å„æœ‰ç”¨äº symmetric key encryption çš„ key å’Œç”¨äº HMAC çš„ keyï¼Œå¦‚æœä½¿ç”¨ CBC åˆ™è¿˜æœ‰åŒæ–¹çš„ IVã€‚
6.  client å‘é€ä¸Šé¢è¿™äº› handshake message çš„ HMACï¼ˆå¯ä»¥å’Œ encrypted PMS ä¸€åŒå‘é€ï¼‰ã€‚
7.  server å‘é€ä¸Šé¢è¿™äº› handshake message çš„ HMACã€‚

å…¶ä¸­ï¼Œä¸€å¼€å§‹çš„ nonce ç”¨æ¥é˜²æ­¢ replay attackï¼Œå¹¶ä¸” server nonce å‚ä¸ master key çš„è®¡ç®—ï¼Œå¯ä»¥é˜²æ­¢ key å®Œå…¨ç”± client å†³å®šã€‚è€Œæœ€åçš„ HMAC ç”¨æ¥é˜²æ­¢ç¯¡æ”¹ handshake messageï¼Œä¾‹å¦‚å°† supported cipher suites æ”¹ä¸ºåªæœ‰ weak algorithmã€‚

TLS 1.3 å¯¹ handshake è¿‡ç¨‹è¿›è¡Œäº†ç®€åŒ–ã€‚

### TLS Data Transfer

åœ¨ TLS ä¸­ï¼ŒTCP byte stream è¢«åˆ‡åˆ†ä¸º recordsï¼Œä¸ºæ¯ä¸ª record è®¡ç®— HMACï¼Œå¹¶å°† record + HMAC è¿›è¡Œ encryptã€‚è¿™åªä¿è¯äº†æ¯ä¸ª record çš„ integrityï¼Œä¸ºäº†ä¿è¯æ•´ä¸ª byte stream çš„ integrityï¼Œæ¯ä¸ª record è¿˜æœ‰ä¸€ä¸ª sequence numberï¼Œå‚ä¸ HMAC çš„è®¡ç®—ï¼Œæ¥é˜²æ­¢æ”»å‡»è€…å¯¹ record è¿›è¡Œ reorder / replay / removeã€‚

TLS record åŒ…å«ï¼š

1.  type: handshake / data
2.  TLS version
3.  length: ç”¨æ¥æ ‡è®° record çš„ç»“å°¾
4.  data + HMAC, encrypted

### TLS Connection Closure

ä¸ºäº†é˜²æ­¢ truncation attackï¼Œå³ä¼ªé€  TCP FIN segmentï¼Œåœ¨ TLS ä¸­éœ€è¦å…ˆå‘é€ä¿è¯äº† integrity çš„ closure TLS record å†å‘é€ TCP FIN segment æ¥ç»“æŸè¿æ¥ã€‚

## Network-Layer Security: IPsec and Virtual Private Networks

### IPsec and Virtual Private Networks (VPNs)

å¦‚æœä¸€ä¸ª institution ä½äºå¤šä¸ªåœ°ç†ä½ç½®è€Œæƒ³ä¿è¯ institution å†…é€šä¿¡çš„ç§å¯†ï¼Œä¸€ç§é€‰æ‹©æ˜¯å»ºç«‹ä¸€ä¸ª private networkï¼Œåœ¨ç‰©ç†ä¸Šä¸ Internet è¿›è¡Œéš”ç¦»ï¼Œä½†è¿™æ ·éœ€è¦è‡ªå·±æ­å»ºæ•´å¥—ç½‘ç»œåŸºç¡€è®¾æ–½ï¼Œå¼€é”€éå¸¸å¤§ã€‚

å¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨ virtual private networkã€‚åœ¨ VPN å†…ï¼Œé€šè¿‡ Internet ä¼ è¾“æ•°æ®æ—¶ä¼šè¿›è¡ŒåŠ å¯†ï¼Œå…·ä½“æ¥è¯´æ˜¯åœ¨å†…ç½‘çš„ gateway router æˆ–ç›´æ¥è¿åˆ°å…¬ç½‘çš„ host å¤„ï¼ˆä¾‹å¦‚å­¦æ ¡è¿åˆ° Internet çš„ gateway router / å›å®¶äº†çš„å­¦ç”Ÿçš„è®¾å¤‡ä¸Šï¼›ä¸ºäº†å™è¿°æ–¹ä¾¿ï¼Œä¸‹æ–‡ä¸­éƒ½å‡è®¾æ˜¯ gateway router è€Œä¸æ˜¯ hostï¼‰åœ¨ payload å‰åŠ ä¸Š IPsec headerã€‚

### The AH and ESP Protocols

IPsec å¯ä»¥ä½¿ç”¨ Authentication Header (AH) protocol æˆ–è€… Encapsulation Security Payload (ESP) protocolã€‚å…¶ä¸­ AH åªæä¾›äº† source authentication å’Œ data integrityï¼ŒESP åœ¨æ­¤åŸºç¡€ä¸Šè¿˜æä¾›äº† confidentialityã€‚ä½¿ç”¨ IPsec çš„åœºæ™¯ä¸­é€šå¸¸éœ€è¦ä¿è¯ confidentialityï¼Œæ‰€ä»¥ ESP ç”¨å¾—æ›´å¤šï¼Œä¹¦ä¸­åªè®² ESPã€‚

### Security Associations

ä¸¤ä¸ª entity (gateway router) é€šè¿‡ IPsec é€šä¿¡æ—¶éœ€è¦å»ºç«‹ç§°ä½œ *security association* (SA) çš„ logical connectionã€‚SA æ˜¯å•å‘çš„ï¼Œå¦‚æœè¦äº’å‘æ¶ˆæ¯åˆ™éœ€è¦å»ºç«‹ä¸¤ä¸ª SAã€‚

SA æœ‰ä¸‹åˆ— state informationï¼š

-   *security parameter index* (SPI)ï¼Œä¸€ä¸ª 32-bit identifier
-   source & destination IP address
-   encryption algorithm, encryption key
-   integrity check algorithm, authentication key

ä¸€ä¸ª IPsec entity å¯èƒ½åŒæ—¶ maintain ç€å¾ˆå¤š SA çš„ state informationï¼Œå­˜å‚¨åœ¨ security association database (SAD) ä¸­ã€‚

### The IPsec Datagram

IPsec æœ‰ä¸¤ç§ packet formï¼Œåˆ†åˆ«ç”¨äº tunnel mode å’Œ transport modeï¼Œå…¶ä¸­ tunnel mode æ›´å¸¸ç”¨ï¼Œä¹¦ä¸­åªè®² tunnel modeã€‚

ä¸€ä¸ª IPsec datagram çš„ç»“æ„å¦‚ä¸‹ï¼š

-   new IP header (source / destination æ˜¯ gateway routerï¼Œprotocol æ˜¯ ESP)
-   â€œenchiladaâ€ (authenticated)
    -   ESP header
        -   SPI
        -   sequence number
    -   (encrypted)
        -   original IP header
        -   original IP payload
        -   ESP trailer
            -   padding (for encryption block size requirement)
            -   padding length
            -   next header ï¼ˆâ€œ4â€ for â€œIP Encapsulation within IPâ€ in tunnel modeï¼‰[^esp-next-header]
-   ESP MAC ï¼ˆfor authentication of the â€œenchiladaâ€ï¼‰

[^esp-next-header]: å¯ä»¥å‚è€ƒ http://www.tcpipguide.com/free/t_IPSecEncapsulatingSecurityPayloadESP-2.htm

gateway router ä¼šç»´æŠ¤ä¸€ä¸ª security policy database (SPD)ï¼Œå½“å…¶æ¥æ”¶åˆ°ä¸€ä¸ªå¾…è½¬å‘çš„ IP datagram æ—¶ï¼Œä¼šæŸ¥è¯¢ SPDï¼Œæ ¹æ® source IP addressã€destination IP addressã€protocol æ¥å†³å®šæ˜¯å¦ä½¿ç”¨ IPsec è¿›è¡Œå¤„ç†ã€‚

### IKE: Key Management in IPsec

IPsec å¯ä»¥æ‰‹åŠ¨é…ç½® keyï¼Œä½†å¤§å‹çš„ VPN å¾€å¾€éœ€è¦ä½¿ç”¨ Internet Key Exchange (IKE) protocol æ¥è‡ªåŠ¨å»ºç«‹ SAã€‚

ï¼ˆä¹¦ä¸­å¯¹ IKE çš„æè¿°å¤ªç®€é™‹äº†ï¼Œè¯´äº†è·Ÿæ²¡è¯´å·®ä¸å¤šï¼Œä»¥åå†è¯´å§ï¼ˆ

## Securing Wireless LANs and 4G/5G Cellular Networks

<Card type="wip">

æœªå®Œå¾…ç»­â€¦â€¦ ğŸ•Šï¸

</Card>

## Operational Security: Firewalls and Intrusion Detection Systems

### Firewalls

firewall ç”¨æ¥æ§ç½®å“ªäº›æµé‡å¯ä»¥è¿›å…¥ internal network / hostï¼Œä¸€èˆ¬è¦ä¿è¯æ‰€æœ‰å‡ºå…¥çš„æµé‡éƒ½ç»è¿‡ firewallï¼Œå¹¶ä¸” firewall è‡ªèº«ä¸ä¼šè¢«æ”»å‡»è€…æ§åˆ¶ã€‚

#### Traditional Packet Filters

é€šè¿‡ packet header æ¥æ§åˆ¶æ˜¯å¦å…è®¸ packet é€šè¿‡ã€‚ä¾‹å¦‚æ ¹æ® IP addressã€protocol typeã€portã€TCP flagsã€ICMP message typeã€router interface ç­‰è¿›è¡Œæ§åˆ¶ã€‚

ä¸€äº› packet filter å¯ä»¥å®ç°çš„ policy çš„ä¾‹å­ï¼š

-   drop outgoing çš„å¯¹ port 80/443 çš„è®¿é—®ï¼šç¦æ­¢è®¿é—®å¤–éƒ¨ Webã€‚
-   drop incoming TCP SYN segmentï¼šç¦æ­¢ä»å¤–ç•Œåˆ›å»º TCP connectionã€‚
-   drop é™¤äº†å¤–ç•Œ port æ˜¯ 53 çš„æ‰€æœ‰ UDP trafficï¼šç¦æ­¢å…¶ä»– UDP trafficï¼Œåªå…è®¸ DNSã€‚
-   drop å‘å‘ broadcast address çš„ ICMP ping packetsï¼šé¿å…é­å— smurf DoS attackã€‚
-   drop outgoing ICMP TTL expired packetsï¼šé¿å…è¢« tracerouteã€‚

#### Stateful Packet Filters

stateful packet filter å¯ä»¥é€šè¿‡è®°å½•çŠ¶æ€ä¿¡æ¯æ¥å®ç°æ›´å¤æ‚çš„æ§åˆ¶ï¼Œä¾‹å¦‚è·Ÿè¸ª TCP connectionï¼Œä»è€Œæ›´åŠ ç²¾å‡†åœ°åªå…è®¸ä»å†…éƒ¨å»ºç«‹çš„ TCP connection è€Œæ‹’ç»ä»å¤–éƒ¨å»ºç«‹çš„ TCP connectionã€‚

#### Application Gateway

packet filter åªæ ¹æ® header ä¸­çš„ä¿¡æ¯è¿›è¡Œæ§åˆ¶ï¼Œè€Œä¸ç®¡ application dataã€‚

application gateway æ˜¯ä¸€ä¸ª application-specific serverï¼Œæ‰€æœ‰ application data éƒ½éœ€è¦é€šè¿‡å®ƒã€‚ä¸€ä¸ª host å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ª application gatewayã€‚

application gateway å¯ä»¥æ ¹æ® application data è¿›è¡Œæ§åˆ¶ï¼Œæä¾›ä¾‹å¦‚ authorization çš„é«˜çº§ filter åŠŸèƒ½ï¼Œè¿˜å¯ä»¥æä¾›é™¤äº† filter å¤–çš„å…¶ä»–åŠŸèƒ½ï¼Œä¾‹å¦‚ proxyã€‚

### Intrusion Detection Systems

å’Œ application gateway ç±»ä¼¼ï¼Œintrusion detection system (IDS) ä¸æ­¢æŸ¥çœ‹ headerï¼Œè¿˜ä¼šæŸ¥çœ‹ application dataï¼Œè¿™ç§°ä½œ deep packet inspectionã€‚

ä¸ application gateway ä¸åŒï¼ŒIDS ä¸æ˜¯ application-specific çš„ï¼Œè€Œæ˜¯ä¼šæ£€æµ‹åˆ°å„ç§å„æ ·çš„ suspicious packet / series of packetsï¼Œä¾‹å¦‚ network mappingã€port scanã€TCP stack scanã€DoS attackã€worm / virusã€OS / application vulnerability attackã€‚æ£€æµ‹åˆ°æ—¶ï¼ŒIDS ä¼šå‘ç®¡ç†å‘˜å‘é€è­¦å‘Šï¼Œè€Œ intrustion prevention system (IPS) åˆ™ä¼š filter out è¿™äº› packetã€‚

å› ä¸º deep packet inspection éœ€è¦ä¸€å®šçš„ç®—åŠ›ï¼Œå½“æµé‡è¿‡å¤§æ—¶ï¼Œä¸€ä¸ª organization å¾€å¾€éœ€è¦å¤šä¸ª IDSï¼Œåˆ†æ•£åœ¨ç½‘ç»œä¸­ï¼Œè€Œéåªè®¾ç½®ä¸€ä¸ªåœ¨æ•´ä¸ªç½‘ç»œçš„å…¥å£ã€‚

IDS åˆ†ä¸º signature-based å’Œ anomaly-based ä¸¤ç§ã€‚

signature å³ packet çš„ç‰¹å¾ï¼Œä¾‹å¦‚ header çš„æŸäº›é¡¹ä»¥åŠ application data åŒ…å«æŸä¸€å†…å®¹ã€‚IDS ç»´æŠ¤äº†ä¸€ä¸ª signature database ç”¨æ¥è¿›è¡ŒåŒ¹é…ã€‚signature-based IDS éœ€è¦äº‹å…ˆçŸ¥é“ attack çš„ç‰¹å¾ï¼Œæ‰€ä»¥æ— æ³•é˜²èŒƒæ–°å‹ attackã€‚signature çš„åŒ¹é…å®¹æ˜“å‡ºç° false alarmï¼Œè€Œä¸”æ€§èƒ½å¼€é”€è¾ƒå¤§ã€‚

anomaly-based IDS åŸºäºå¹³æ—¶çš„ traffic æ¥æ£€æµ‹ statistically unusual çš„ trafficï¼Œä¾‹å¦‚æ£€æµ‹åˆ°çªç„¶å¢å¤šçš„ ICMP packetsã€‚anomaly-based IDS ä¸ä¾èµ–äºå®ç°å¯¹æ”»å‡»çš„äº†è§£ï¼Œæ‰€ä»¥æœ‰å¯èƒ½æ£€æµ‹åˆ°æ–°å‹çš„æ”»å‡»ã€‚ä½†æ˜¯åŒºåˆ† normal traffic å’Œ statistically unusual traffic æ˜¯å›°éš¾çš„ï¼Œç°åœ¨çš„ IDS é€šå¸¸è¿˜æ˜¯ä»¥ signature-based ä¸ºä¸»ã€‚

Snort æ˜¯ä¸€æ¬¾ open-source IDSï¼Œæœ‰ä¸€ä¸ªæ´»è·ƒçš„ community ç»´æŠ¤ç€ signature databaseã€‚
